
#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Args = Args();
#-------------------------------------------------------------------------------
$FeatureID = (integer) @$Args['FeatureID'];
$VersionID = (integer) @$Args['VersionID'];
$TypeID    =  (string) @$Args['TypeID'];
$Title     =  (string) @$Args['Title'];
$Comment   =  (string) @$Args['Comment'];
#-------------------------------------------------------------------------------
if(Is_Error(System_Load('modules/Authorisation.mod')))
  return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
if(!In_Array($TypeID,Array('new','bug','update')))
  return new gException('WRONG_TYPE','Тип указан неверно');
#-------------------------------------------------------------------------------
if(!$Title)
  return new gException('TITLE_NOT_FILLED','Заголовок не указан');
#-------------------------------------------------------------------------------
if(!$Comment)
  return new gException('TITLE_NOT_FILLED','Комментарий не указан');
#-------------------------------------------------------------------------------
$IFeature = Array(
  #-----------------------------------------------------------------------------
  'VersionID' => ($VersionID?$VersionID:NULL),
  'TypeID'    => $TypeID,
  'Title'     => $Title,
  'Comment'   => $Comment
);
#-------------------------------------------------------------------------------
if($FeatureID){
  #-----------------------------------------------------------------------------
  $IsUpdate = DB_Update('Features',$IFeature,Array('ID'=>$FeatureID));
  if(Is_Error($IsUpdate))
    return ERROR | @Trigger_Error(500);
  #-----------------------------------------------------------------------------
}else{
  #-----------------------------------------------------------------------------
  $FeatureID = DB_Insert('Features',$IFeature);
  if(Is_Error($FeatureID))
    return ERROR | @Trigger_Error(500);
}
#-------------------------------------------------------------------------------
return Array('Status'=>'Ok');
#-------------------------------------------------------------------------------
