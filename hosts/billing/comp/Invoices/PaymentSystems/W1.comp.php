<?php

#-------------------------------------------------------------------------------
/** @author Alex Keda (for www.host-food.ru) */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('PaymentSystemID','InvoiceID','Summ');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Config = Config();
#-------------------------------------------------------------------------------
$Settings = $Config['Invoices']['PaymentSystems']['W1'];
#-------------------------------------------------------------------------------
$Send = $Settings['Send'];
#-------------------------------------------------------------------------------
$Send['WMI_PAYMENT_AMOUNT'] = Round($Summ/$Settings['Course'],2);
#-------------------------------------------------------------------------------
$Send['WMI_PAYMENT_NO'] = $InvoiceID;
#-------------------------------------------------------------------------------
$Comp = Comp_Load('Formats/Invoice/Number',$InvoiceID);
if(Is_Error($Comp))
  return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$__USER = $GLOBALS['__USER'];
$Send['WMI_DESCRIPTION'] .= SPrintF('%s, %s (%s)',$Comp,Translit($__USER['Name']),$__USER['Email']);
#-------------------------------------------------------------------------------
$Protocol = (@$_SERVER['SERVER_PORT'] != 80?'https':'http');
#-------------------------------------------------------------------------------
$Send['WMI_SUCCESS_URL'] = SPrintF('%s://%s/Invoices',$Protocol,HOST_ID);
$Send['WMI_FAIL_URL']    = SPrintF('%s://%s/Invoices?Error=yes',$Protocol,HOST_ID);
#-------------------------------------------------------------------------------
$Hash = Array(
  #-----------------------------------------------------------------------------a
  $Send['WMI_CURRENCY_ID'],
  $Send['WMI_DESCRIPTION'],
  $Send['WMI_FAIL_URL'],
  $Send['WMI_MERCHANT_ID'],
  $Send['WMI_PAYMENT_AMOUNT'],
  $Send['WMI_PAYMENT_NO'],
  $Send['WMI_SUCCESS_URL'],
  $Settings['Hash']
);
#-------------------------------------------------------------------------------
$Send['WMI_SIGNATURE'] = base64_encode(pack("H*",sha1(Implode('',$Hash))));
#-------------------------------------------------------------------------------
return $Send;
#-------------------------------------------------------------------------------


?>
