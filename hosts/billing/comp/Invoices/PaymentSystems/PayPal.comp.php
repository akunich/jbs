<?php

#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('PaymentSystemID','InvoiceID','Summ');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Config = Config();
#-------------------------------------------------------------------------------
$Settings = $Config['Invoices']['PaymentSystems']['PayPal'];
#-------------------------------------------------------------------------------
$Send = $Settings['Send'];
#-------------------------------------------------------------------------------
$Send['amount'] = Round($Summ/$Settings['Course'],2);
#-------------------------------------------------------------------------------
$Send['item_number'] = $InvoiceID;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Protocol = (@$_SERVER['SERVER_PORT'] != 80?'https':'http');
#-------------------------------------------------------------------------------
$Send['return'] = SPrintF('%s://%s/Invoices',$Protocol,HOST_ID);
#-------------------------------------------------------------------------------
$Send['cancel_return'] = SPrintF('%s://%s/Invoices?Error=yes',$Protocol,HOST_ID);
#-------------------------------------------------------------------------------
$Send['notify_url'] = SPrintF('%s://%s/Merchant/PayPal',$Protocol,HOST_ID);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Send['currency_code'] = $Settings['Valute'];
#-------------------------------------------------------------------------------
$Send['cmd'] = '_xclick';
#-------------------------------------------------------------------------------
#image_url https://www.host-food.ru/images/host-food-ru-avarar.jpg
$Send['invoice'] = $InvoiceID;

$Send['lc'] = '';
$Send['no_note'] = 1;
$Send['no_shipping'] = 1;
$Send['rm'] = 1;
$Send['charset'] = 'utf-8';

#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$__USER = $GLOBALS['__USER'];
#-------------------------------------------------------------------------------
$Comp = Comp_Load('Formats/Invoice/Number',$InvoiceID);
if(Is_Error($Comp))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$Send['item_name'] .= SPrintF('%s, %s (%s)',$Comp,Translit($__USER['Name']),$__USER['Email']);
#$Send['item_name'] = 'payment ' . $Comp;
#-------------------------------------------------------------------------------
return $Send;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

?>
