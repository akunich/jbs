<?php

#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('Interface');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
if(Is_Error(System_Load('libs/TemplateReplace.php')))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
if(IsSet($GLOBALS['__USER'])){
  # cache added by lissyara, 2011-10-03 in 21:16 MSK
  $CacheID = Md5($__FILE__ . $GLOBALS['__USER']['ID']);
  $Result = CacheManager::get($CacheID);
  if($Result)
    return $Result;
  #-----------------------------------------------------------------------------
  $Table = new Tag('TABLE',Array('cellspacing'=>0,'style'=>'margin-bottom: 5px; width: 100%'));
  #-----------------------------------------------------------------------------
  $HostsIDs = $GLOBALS['HOST_CONF']['HostsIDs'];
  #-----------------------------------------------------------------------------
  foreach($HostsIDs as $HostID){
    #---------------------------------------------------------------------------
    $Folder = SPrintF('%s/hosts/%s/comp/Notes/%s',SYSTEM_PATH,$HostID,$Interface);
    #---------------------------------------------------------------------------
    if(!File_Exists($Folder))
      continue;
    #---------------------------------------------------------------------------
    $Files = IO_Scan($Folder);
    if(Is_Error($Files))
      return ERROR | @Trigger_Error(500);
    #---------------------------------------------------------------------------
    foreach($Files as $File){
      #-------------------------------------------------------------------------
      $Notes = Comp_Load(SPrintF('Notes/%s/%s',$Interface,SubStr($File,0,StriPos($File,'.'))));
      if(Is_Error($Notes))
        return ERROR | @Trigger_Error(500);
      #-------------------------------------------------------------------------
      foreach($Notes as $Note){
        #-----------------------------------------------------------------------
        $Comp = Comp_Load('Information',$Note,'Warning');
        if(Is_Error($Comp))
          return ERROR | @Trigger_Error(500);
        #-----------------------------------------------------------------------
        $Table->AddChild(new Tag('TR',new Tag('TD',$Comp)));
      }
    }
  }
  #-----------------------------------------------------------------------------
  $Table->Childs = Array_Reverse($Table->Childs);
  #-----------------------------------------------------------------------------
  $Out = (Count($Table->Childs)?$Table:new Tag('NOBODY','No nodes...'));
  #-----------------------------------------------------------------------------
  CacheManager::add($CacheID,$Out,60);
  return $Out;
}
#-------------------------------------------------------------------------------
return new Tag('NOBODY','User not authorisated...');
#-------------------------------------------------------------------------------

?>
