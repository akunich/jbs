<?php

#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('Length','UseLetters','UseDigits','UseSpecials');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
# Наборы символов используемых для построения паролей
$Letters	= 'qwertyuiopasdfghjklzxcvbnm';
$Digits		= '0123456789';
$Specials	= '@#%';
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Config = Config();
$Settings = $Config['Other']['PasswordsGenerator'];
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
# Длинна пароля. Если не задано, используем дефолт из конфига
$Length = ($Length)?$Length:$Settings['Length'];
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Chars = '';
#-------------------------------------------------------------------------------
$Chars = SPrintF('%s%s',$Chars,($UseLetters)?$Letters:($Settings['UseLetters']?$Letters:''));
#-------------------------------------------------------------------------------
$Chars = SPrintF('%s%s',$Chars,($UseDigits)?$Digits:($Settings['UseDigits']?$Digits:''));
#-------------------------------------------------------------------------------
$Chars = SPrintF('%s%s',$Chars,($UseSpecials)?$Specials:($Settings['UseSpecials']?$Specials:''));
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
# число символов по которым строим пароль
$Size = StrLen($Chars) - 1;
#-------------------------------------------------------------------------------
if($Size < 1){
	#-------------------------------------------------------------------------------
	Debug(SPrintF('[comp/Passwords/Generator]: наборы символов явно не заданы для построения пароля, используем весь диапазон'));
	#-------------------------------------------------------------------------------
	$Chars = SPrintF('%s%s',$Letters,$Digits);
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
Debug(SPrintF('[comp/Passwords/Generator]: Chars = %s',$Chars));
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Password = '';
#-------------------------------------------------------------------------------
while($Length--){
	#-------------------------------------------------------------------------------
	$Char = $Chars[Mt_Rand(0,$Size)];
	#-------------------------------------------------------------------------------
	# рандомно, символ переводим в верхний регистр
	$Char = (Mt_Rand(0,2)%3)?$Char:StrToUpper($Char);
	#-------------------------------------------------------------------------------
	$Password = SPrintF('%s%s',$Password,$Char);
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return $Password;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

?>
