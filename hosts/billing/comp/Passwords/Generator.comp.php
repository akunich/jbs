<?php

#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('Length','DigitsOnly');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
# Наборы символов используемых для построения паролей
$Letters	= 'qwertyuiopasdfghjklzxcvbnm';
$Digits		= '0123456789';
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Config = Config();
$Settings = $Config['Other']['PasswordGenerator'];
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
# Длинна пароля. Если не задано, используем дефолт из конфига
$Length = ($Length)?$Length:$Settings['Length'];
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
# определяем наборы символов для работы
# строим начало пасса - одна рандомная цифра, одна рандомная буква в нижнем регистре, одна рандомная буква в верхнем регистре
if($DigitsOnly){
	#-------------------------------------------------------------------------------
	$Chars = $Digits;
	#-------------------------------------------------------------------------------
	$Password = '';
	#-------------------------------------------------------------------------------
}else{
	#-------------------------------------------------------------------------------
	$Chars = SPrintF('%s%s',$Letters,$Digits);
	#-------------------------------------------------------------------------------
	# одна рандомная цифра
	$Password = $Digits[Mt_Rand(0,(StrLen($Digits) - 1))];
	#-------------------------------------------------------------------------------
	# одна рандомная буква в нижнем регистре
	$Password = SPrintF('%s%s',$Letters[Mt_Rand(0,(StrLen($Letters) - 1))],$Password);
	#-------------------------------------------------------------------------------
	# одна рандомная буква в верхнем регистре
	$Password = SPrintF('%s%s',StrToUpper($Letters[Mt_Rand(0,(StrLen($Letters) - 1))]),$Password);

}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
# число символов по которым строим пароль
$Size = StrLen($Chars) - 1;
#-------------------------------------------------------------------------------
#Debug(SPrintF('[comp/Passwords/Generator]: Chars = %s',$Chars));
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
# длинна пароля, необходимая длинна минус то что уже построено
$Length = $Length - StrLen($Password);
#-------------------------------------------------------------------------------
while($Length--){
	#-------------------------------------------------------------------------------
	$Char = $Chars[Mt_Rand(0,$Size)];
	#-------------------------------------------------------------------------------
	# рандомно, символ переводим в верхний регистр
	$Char = (Mt_Rand(0,2)%3)?$Char:StrToUpper($Char);
	#-------------------------------------------------------------------------------
	$Password = SPrintF('%s%s',$Password,$Char);
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return Str_Shuffle($Password);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

?>
