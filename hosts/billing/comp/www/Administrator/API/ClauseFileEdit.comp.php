<?php


#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Args = Args();
#-------------------------------------------------------------------------------
$ClauseID = (integer) @$Args['ClauseID'];
$Comment  =  (string) @$Args['Comment'];
#-------------------------------------------------------------------------------
if(Is_Error(System_Load('modules/Authorisation.mod','libs/Upload.php')))
  return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
if(!$Comment)
  return new gException('COMMENT_IS_EMPTY','Введите комментарий к файлу');
#-------------------------------------------------------------------------------
$Upload = Upload_Get('ClauseFile');
#-------------------------------------------------------------------------------
switch(ValueOf($Upload)){
  case 'error':
    return ERROR | @Trigger_Error(500);
  case 'exception':
    return $Upload;
  case 'array':
    #---------------------------------------------------------------------------
    $IClauseFile = Array(
      #-------------------------------------------------------------------------
      'ClauseID' => $ClauseID,
      'FileName' => $Upload['Name'],
      'FileData' => $Upload['Data'],
      'Comment'  => $Comment,
    );
    #---------------------------------------------------------------------------
    $ClauseFileID = DB_Insert('ClausesFiles',$IClauseFile);
    if(Is_Error($ClauseFileID))
      return ERROR | @Trigger_Error(500);
    #---------------------------------------------------------------------------
    return Array('Status'=>'Ok');
  default:
    return ERROR | @Trigger_Error(101);
}
#-------------------------------------------------------------------------------

?>
