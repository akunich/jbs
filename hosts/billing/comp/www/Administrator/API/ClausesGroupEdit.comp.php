<?php

#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
/******************************************************************************/
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
if(Is_Error(System_Load('modules/Authorisation.mod')))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$Args = Args();
#-------------------------------------------------------------------------------
$GroupID	= (integer) @$Args['GroupID'];
$Name		=  (string) @$Args['Name'];
$Notice		=  (string) @$Args['Notice'];
$IsProtected	= (boolean) @$Args['IsProtected'];
$IsPublish	= (boolean) @$Args['IsPublish'];
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
if($GroupID){
	#-------------------------------------------------------------------------------
	$Count = DB_Count('ClausesGroupsOwners',Array('ID'=>$GroupID));
	if(Is_Error($Count))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	if(!$Count)
		return new gException('CLAUSE_GROUP_NOT_FOUND','Группа статей не найдена');
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
if(!$Name)
	return new gException('NAME_NOT_FILLED','Имя группы не указано');
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
if(!$Notice)
	return new gException('NOTICE_NOT_FILLED','Описание группы не указано');
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$__USER = $GLOBALS['__USER'];
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$IClausesGroup = Array(
			'Name'		=> $Name,
			'Notice'	=> $Notice,
			'IsProtected'	=> $IsProtected,
			'IsPublish'	=> $IsPublish,
			'ChangedDate'	=> Time(),
			'EditorID'	=> $__USER['ID']
			);
#-------------------------------------------------------------------------------
if($GroupID){
	#-------------------------------------------------------------------------------
	$IsUpdate = DB_Update('ClausesGroups',$IClausesGroup,Array('ID'=>$GroupID));
	if(Is_Error($IsUpdate))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
}else{
	#-------------------------------------------------------------------------------
	$IClausesGroup['AuthorID']	= $__USER['ID'];
	$IClausesGroup['PublicDate']	= Time();
	#-------------------------------------------------------------------------------
	$IsInsert = DB_Insert('ClausesGroups',$IClausesGroup);
	if(Is_Error($IsInsert))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return Array('Status'=>'Ok');
#-------------------------------------------------------------------------------

?>
