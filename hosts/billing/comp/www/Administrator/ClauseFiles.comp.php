<?php

#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Args = Args();
#-------------------------------------------------------------------------------
$ClauseID = (integer) @$Args['ClauseID'];
#-------------------------------------------------------------------------------
if(Is_Error(System_Load('modules/Authorisation.mod','classes/DOM.class.php','libs/Upload.php')))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$DOM = new DOM();
#-------------------------------------------------------------------------------
$Links = &Links();
# Коллекция ссылок
$Links['DOM'] = &$DOM;
#-------------------------------------------------------------------------------
if(Is_Error($DOM->Load('Standard')))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$DOM->Delete('Title');
#-------------------------------------------------------------------------------
$Files = GetUploadedFilesInfo('Clauses',$ClauseID);
#-------------------------------------------------------------------------------
if(!SizeOf($Files)){
	#-------------------------------------------------------------------------------
	$P = new Tag('P','Нет файлов');
	#-------------------------------------------------------------------------------
	$DOM->AddChild('Into',$P);
	#-------------------------------------------------------------------------------
}else{
	#-------------------------------------------------------------------------------
	$Table = new Tag('TABLE',Array('class'=>'Standard','cellspacing'=>5));
	#-------------------------------------------------------------------------------
	$Tr = new Tag('TR');
	#-------------------------------------------------------------------------------
	foreach($Files as $File){
		#-------------------------------------------------------------------------------
		$Td = new Tag('TD',Array('class'=>'Standard','align'=>'center'));
		#-------------------------------------------------------------------------------
		$Delete = SPrintF('onclick="JavaScript:ShowConfirm(\'Вы подтверждаете удаление файла?\',\'AjaxCall(\\\'/API/FileDelete\\\',{FileID:%u},\\\'Удаление файла\\\',\\\'GetURL(document.location);\\\');\');"',$File['ID'],$File['ID']);
		$Td->AddChild(new Tag('DIV',new Tag('A',Array('OnClick'=>SPrintF('location.assign("/Administrator/ClauseFiles?ClauseID=%u");',$File['RowID']),'href'=>SPrintF('/API/FileDelete?FileID=%u',$File['ID']),),new Tag('FONT',Array('size'=>1),'[удалить]'))));
		#-------------------------------------------------------------------------------
		$Comp = Comp_Load('Clauses/File',$File);
		if(Is_Error($Comp))
			return ERROR | @Trigger_Error(500);
		#-------------------------------------------------------------------------------
		$Td->AddChild($Comp);
		#-------------------------------------------------------------------------------
		$Tr->AddChild($Td);
		#-------------------------------------------------------------------------------
		if(Count($Tr->Childs)%4 == 0){
			#-------------------------------------------------------------------------------
			$Table->AddChild($Tr);
			#-------------------------------------------------------------------------------
			$Tr = new Tag('TR');
			#-------------------------------------------------------------------------------
		}
		#-------------------------------------------------------------------------------
	}
	#-------------------------------------------------------------------------------
	if(Count($Tr->Childs))
		$Table->AddChild($Tr);
	#-------------------------------------------------------------------------------
	$DOM->AddChild('Into',$Table);
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Out = $DOM->Build();
#-------------------------------------------------------------------------------
if(Is_Error($Out))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return $Out;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
?>
