<?php


#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Args = Args();
#-------------------------------------------------------------------------------
$ClauseID = (integer) @$Args['ClauseID'];
#-------------------------------------------------------------------------------
if(Is_Error(System_Load('modules/Authorisation.mod','classes/DOM.class')))
  return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$DOM = new DOM();
#-------------------------------------------------------------------------------
$Links = &Links();
# Коллекция ссылок
$Links['DOM'] = &$DOM;
#-------------------------------------------------------------------------------
if(Is_Error($DOM->Load('Standard')))
  return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$DOM->Delete('Title');
#-------------------------------------------------------------------------------
$ClauseFiles = DB_Select('ClausesFiles','ID',Array('Where'=>SPrintF('`ClauseID` = %u',$ClauseID)));
#-------------------------------------------------------------------------------
switch(ValueOf($ClauseFiles)){
  case 'error':
    return ERROR | @Trigger_Error(500);
  case 'exception':
    #---------------------------------------------------------------------------
    $P = new Tag('P','Нет файлов');
    #---------------------------------------------------------------------------
    $DOM->AddChild('Into',$P);
  break;
  case 'array':
    #---------------------------------------------------------------------------
    $Table = new Tag('TABLE',Array('class'=>'Standard','cellspacing'=>5));
    #---------------------------------------------------------------------------
    $Tr = new Tag('TR');
    #---------------------------------------------------------------------------
    foreach($ClauseFiles as $ClauseFile){
      #-------------------------------------------------------------------------
      $ClauseFileID = $ClauseFile['ID'];
      #-------------------------------------------------------------------------
      $Td = new Tag('TD',Array('class'=>'Standard','align'=>'center'));
      #-------------------------------------------------------------------------
      $Td->AddChild(new Tag('DIV',new Tag('A',Array('href'=>SPrintF('/Administrator/API/ClauseFileDelete?ClauseFileID=%s',$ClauseFileID)),new Tag('FONT',Array('size'=>1),'[удалить]'))));
      #-------------------------------------------------------------------------
      $Comp = Comp_Load('Clauses/File',$ClauseFileID);
      if(Is_Error($Comp))
        return ERROR | @Trigger_Error(500);
      #-------------------------------------------------------------------------
      $Td->AddChild($Comp);
      #-------------------------------------------------------------------------
      $Tr->AddChild($Td);
      #-------------------------------------------------------------------------
      if(Count($Tr->Childs)%6 == 0){
        #-----------------------------------------------------------------------
        $Table->AddChild($Tr);
        #-----------------------------------------------------------------------
        $Tr = new Tag('TR');
      }
    }
    #---------------------------------------------------------------------------
    if(Count($Tr->Childs))
     $Table->AddChild($Tr);
    #---------------------------------------------------------------------------
    $DOM->AddChild('Into',$Table);
  break;
  default:
    return ERROR | @Trigger_Error(101);
}
#-------------------------------------------------------------------------------
$Out = $DOM->Build();
#-------------------------------------------------------------------------------
if(Is_Error($Out))
  return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
return $Out;
#-------------------------------------------------------------------------------

?>
