<?php


#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Args = Args();
#-------------------------------------------------------------------------------
$UserID = (integer) @$Args['UserID'];
#-------------------------------------------------------------------------------
if(Is_Error(System_Load('libs/Image.php')))
  return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$UserID = ($UserID?$UserID:@$GLOBALS['__USER']['ID']);
#-------------------------------------------------------------------------------
if(!$UserID)
  return 'No user defined';
#-------------------------------------------------------------------------------
$User = DB_Select('Users','Foto',Array('UNIQ','ID'=>$UserID));
#-------------------------------------------------------------------------------
switch(ValueOf($User)){
  case 'error':
    return ERROR | @Trigger_Error(500);
  case 'exception':
    return ERROR | @Trigger_Error(400);
  case 'array':
    #---------------------------------------------------------------------------
    $Foto = $User['Foto'];
    #---------------------------------------------------------------------------
    if(!$Foto){
      #-------------------------------------------------------------------------
      $Path = Styles_Element('Images/UserFoto.jpg');
      if(Is_Error($Path))
        return ERROR | @Trigger_Error(500);
      #-------------------------------------------------------------------------
      $Foto = IO_Read($Path);
      if(Is_Error($Foto))
        return ERROR | @Trigger_Error(500);
    }
    #---------------------------------------------------------------------------
    Header('Content-Type: image/jpg');
    #---------------------------------------------------------------------------
    return $Foto;
  default:
    return ERROR | @Trigger_Error(101);
}
#-------------------------------------------------------------------------------

?>
