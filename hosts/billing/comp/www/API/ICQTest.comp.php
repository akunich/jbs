<?php

#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Args = Args();
#-------------------------------------------------------------------------------
$UIN = (integer) @$Args['UIN'];
#-------------------------------------------------------------------------------
if(!$UIN)
	return new gException('UIN_NOT_FILLED','Номер ICQ не указан');
#-------------------------------------------------------------------------------
if(Is_Error(System_Load('modules/Authorisation.mod')))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$Executor = DB_Select('Users','Sign',Array('UNIQ','ID'=>100));
if(!Is_Array($Executor))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$Comp = Comp_Load('Tasks/ICQ',NULL,$UIN,TemplateReplace('www.API.ICQTest',Array('User'=>$GLOBALS['__USER'],'Executor'=>$Executor,'Service'=>'ICQ'),FALSE),$GLOBALS['__USER']['ID']);
#-------------------------------------------------------------------------------
switch(ValueOf($Comp)){
case 'error':
	return new gException('ERROR_MESSAGE_SEND','Не удалось отправить сообщение');
case 'exception':
	#-------------------------------------------------------------------------------
	return $Comp;
	#-------------------------------------------------------------------------------
default:
	break;
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return Array('Status'=>'Ok');
#-------------------------------------------------------------------------------

?>
