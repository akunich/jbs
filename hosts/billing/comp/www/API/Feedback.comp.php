<?php


#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Args = Args();
#-------------------------------------------------------------------------------
$Email   = (string) @$Args['Email'];
$Message = (string) @$Args['Message'];
#-------------------------------------------------------------------------------
$Regulars = Regulars();
#-------------------------------------------------------------------------------
if(!Preg_Match($Regulars['Email'],$Email))
  return new gException('WRONG_EMAIL','Неверно указан электронный адрес');
#-------------------------------------------------------------------------------
if(!$Message)
  return new gException('MESSAGE_IS_EMPTY','Не указано сообщение');
#-------------------------------------------------------------------------------
$Update = DB_Update('Users',Array('Email'=>$Email),Array('ID'=>200));
if(Is_Error($Update))
  return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$IsSend = Notify_Send('Feedback',100,Array('Message'=>$Message),200);
#-------------------------------------------------------------------------------
switch(ValueOf($IsSend)){
  case 'error':
    return ERROR | @Trigger_Error(500);
  case 'exception':
    return ERROR | @Trigger_Error(400);
  case 'true':
    #---------------------------------------------------------------------------
    $Update = DB_Update('Users',Array('Email'=>'user@company.com'),Array('ID'=>200));
    if(Is_Error($Update))
      return ERROR | @Trigger_Error(500);
    #---------------------------------------------------------------------------
    return Array('Status'=>'Ok');
  default:
    return ERROR | @Trigger_Error(101);
}
#-------------------------------------------------------------------------------

?>
