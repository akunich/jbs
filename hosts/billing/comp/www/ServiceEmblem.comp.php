<?php


#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Args = Args();
#-------------------------------------------------------------------------------
$ServiceID = (integer) @$Args['ServiceID'];
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$CacheID = Md5($__FILE__ . $ServiceID);
$Result = CacheManager::get($CacheID);
if(!Is_Error($Result)){
	Header('Content-Type: image');
	Header('Cache-Control: private, max-age=86400');
	return $Result;
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Service = DB_Select('Services','Emblem',Array('UNIQ','ID'=>$ServiceID));
#-------------------------------------------------------------------------------
switch(ValueOf($Service)){
  case 'error':
    return ERROR | @Trigger_Error(500);
  case 'exception':
    return ERROR | @Trigger_Error(400);
  case 'array':
    #---------------------------------------------------------------------------
    $Emblem = $Service['Emblem'];
    #---------------------------------------------------------------------------
    if(!$Emblem){
      #-------------------------------------------------------------------------
      $Emblem = Styles_Element('Images/Icons/ServiceEmblem.jpg');
      if(Is_Error($Emblem))
        return ERROR | @Trigger_Error(500);
      #-------------------------------------------------------------------------
      $Emblem = IO_Read($Emblem);
      if(Is_Error($Emblem))
        return ERROR | @Trigger_Error(500);
    }
    #---------------------------------------------------------------------------
    Header('Content-Type: image');
    Header('Cache-Control: private, max-age=86400');
    #---------------------------------------------------------------------------
    CacheManager::add($CacheID, $Emblem, 24 * 3600);
    #---------------------------------------------------------------------------
    return $Emblem;
  default:
    return ERROR | @Trigger_Error(101);
}
#-------------------------------------------------------------------------------

?>
