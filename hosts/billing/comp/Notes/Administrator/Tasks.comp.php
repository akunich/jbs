<?php
#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$CacheID = Md5($__FILE__);
#-------------------------------------------------------------------------------
$Result = CacheManager::get($CacheID);
#-------------------------------------------------------------------------------
if($Result)
	return $Result;
#-------------------------------------------------------------------------------
$Result = Array();
#-------------------------------------------------------------------------------
$Count = DB_Count('Tasks',Array('Where'=>"(`IsActive` = 'no' OR `Errors` > 0) AND `IsExecuted` = 'no'"));
if(Is_Error($Count))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
if($Count){
	#-------------------------------------------------------------------------------
	$Result = Array();
	#-------------------------------------------------------------------------------
	$NoBody = new Tag('NOBODY');
	#-------------------------------------------------------------------------------
	$NoBody->AddHTML(TemplateReplace('Notes.Administrator.Tasks',Array('Tasks'=>$Count)));
	#-------------------------------------------------------------------------------
	$Result = Array($NoBody);
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
CacheManager::add($CacheID, $Result,60);
#-------------------------------------------------------------------------------
return $Result;
#-------------------------------------------------------------------------------

?>
