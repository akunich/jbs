<?php

#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
/******************************************************************************/
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Result = Array();
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
if(!CacheManager::isEnabled())
	return $Result;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Config = Config();
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
foreach(Array_Keys($Config['Notifies']['Methods']) as $MethodID){
	#-------------------------------------------------------------------------------
	if($MethodID == 'Email')
		$GLOBALS['__USER']['Params']['NotificationMethods'][$MethodID] = Array('Address'=>$GLOBALS['__USER']['Email'],'Confirmed'=>$GLOBALS['__USER']['EmailConfirmed']);
	#-------------------------------------------------------------------------------
	$Settings = $Config['Interface']['User']['Notes'][$MethodID];
	#-------------------------------------------------------------------------------
	$NotificationMethods = $GLOBALS['__USER']['Params']['NotificationMethods'];
	#-------------------------------------------------------------------------------
	if($NotificationMethods[$MethodID]['Address'] && !$NotificationMethods[$MethodID]['Confirmed'] && $Settings['ConfirmRequire']){
		#-------------------------------------------------------------------------------
		$NoBody = new Tag('NOBODY');
		$NoBody->AddHTML(TemplateReplace('Notes.User.Confirmation', Array('Address'=>$NotificationMethods[$MethodID]['Address'],'Method'=>$Config['Notifies']['Methods'][$MethodID])));
		$NoBody->AddChild(new Tag('STRONG', new Tag('A', Array('href' => "javascript:ShowWindow('/UserPersonalDataChange');"), '[Мои настройки]')));
		#-------------------------------------------------------------------------------
		$Result[] = $NoBody;
		#-------------------------------------------------------------------------------
	}
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	if(!$NotificationMethods[$MethodID]['Address'] && $Settings['Require']){
		#-------------------------------------------------------------------------------
		$NoBody = new Tag('NOBODY');
		Debug(print_r($Config['Notifies']['Methods'][$MethodID],true));
		$NoBody->AddHTML(TemplateReplace('Notes.User.Confirmation.NoAddress', Array('Method'=>$Config['Notifies']['Methods'][$MethodID])));
		$NoBody->AddChild(new Tag('STRONG', new Tag('A', Array('href' => "javascript:ShowWindow('/UserPersonalDataChange');"), '[Мои настройки]')));
		#-------------------------------------------------------------------------------
		$Result[] = $NoBody;
		#-------------------------------------------------------------------------------
	}
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return $Result;
#-------------------------------------------------------------------------------
?>
