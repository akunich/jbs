<?php

#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('IsSearch');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Config = Config();
#-------------------------------------------------------------------------------
$Types = $Config['Contracts']['Types'];
#-------------------------------------------------------------------------------
$Filters = Array('Типы договоров');
#-------------------------------------------------------------------------------
foreach($Types as $TypeID=>$Type){
	#-------------------------------------------------------------------------------
	$Filters[$TypeID] = Array('Name'=>$Type['Name'],'UsersIDs'=>Array());
	#-------------------------------------------------------------------------------
	if($IsSearch){
		#-------------------------------------------------------------------------------
		$Contracts = DB_Select('Contracts','UserID',Array('Where'=>SPrintF("`TypeID` = '%s'",$TypeID)));
		#-------------------------------------------------------------------------------
		switch(ValueOf($Contracts)){
		case 'error':
			return ERROR | @Trigger_Error(500);
		case 'exception':
			# No more...
			break;
		case 'array':
			#-------------------------------------------------------------------------------
			$UsersIDs = Array();
			#-------------------------------------------------------------------------------
			foreach($Contracts as $Contract)
				$UsersIDs[] = $Contract['UserID'];
			#-------------------------------------------------------------------------------
			$UsersIDs = Array_Unique($UsersIDs);
			#-------------------------------------------------------------------------------
			$Filters[$TypeID]['UsersIDs'] = $UsersIDs;
			#-------------------------------------------------------------------------------
			break;
			#-------------------------------------------------------------------------------
		default:
			return ERROR | @Trigger_Error(101);
		}
		#-------------------------------------------------------------------------------
	}
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return $Filters;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

?>
