<?php

#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('IsSearch');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Groups = DB_Select('Groups',Array('ID','Name'));
#-------------------------------------------------------------------------------
switch(ValueOf($Groups)){
case 'error':
	return ERROR | @Trigger_Error(500);
case 'exception':
	return FALSE;
case 'array':
	#-------------------------------------------------------------------------------
	$Filters = Array('Группы пользователей');
	#-------------------------------------------------------------------------------
	foreach($Groups as $Group){
		#-------------------------------------------------------------------------------
		$Filter = Array('Name'=>$Group['Name'],'UsersIDs'=>Array());
		#-------------------------------------------------------------------------------
		if($IsSearch){
			#-------------------------------------------------------------------------------
			$Users = DB_Select('Users','ID',Array('Where'=>SPrintF('`GroupID` = %u',$Group['ID'])));
			#-------------------------------------------------------------------------------
			switch(ValueOf($Users)){
			case 'error':
				return ERROR | @Trigger_Error(500);
			case 'exception':
				# No more...
				break;
			case 'array':
				#-------------------------------------------------------------------------------
				$UsersIDs = Array();
				#-------------------------------------------------------------------------------
				foreach($Users as $User)
					$UsersIDs[] = $User['ID'];
				#-------------------------------------------------------------------------------
				$Filter['UsersIDs'] = $UsersIDs;
				#-------------------------------------------------------------------------------
				break;
				#-------------------------------------------------------------------------------
			default:
				return ERROR | @Trigger_Error(101);
			}
			#-------------------------------------------------------------------------------
		}
		#-------------------------------------------------------------------------------
		$Filters[$Group['ID']] = $Filter;
		#-------------------------------------------------------------------------------
	}
	#-------------------------------------------------------------------------------
	return $Filters;
	#-------------------------------------------------------------------------------
default:
	return ERROR | @Trigger_Error(101);
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

?>
