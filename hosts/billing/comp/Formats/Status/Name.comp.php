<?php

#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('ModeID','StatusID','RowID','Length');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Config = Config();
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
# wrapper for JBS-184
$StrExpl = explode(':', $ModeID, 2);
#-------------------------------------------------------------------------------
if(IsSet($StrExpl[1])){
	# делаем запрос к базе, ищщем по нужной таблице нужный номер
	# wrappers for JBS-148
	if($StrExpl[0] == "Default"){
		#-------------------------------------------------------------------------------
		$ModeID = "Orders";
		#-------------------------------------------------------------------------------
	}else{
		#-------------------------------------------------------------------------------
		$Order = DB_Select(SPrintF('%sOrdersOwners',$StrExpl[0]),Array('ID'),Array('UNIQ','Where'=>SPrintF('`OrderID` = %u',$RowID)));
		#-------------------------------------------------------------------------------
		switch(ValueOf($Order)){
		case 'error':
			return ERROR | @Trigger_Error(500);
		case 'exception':
			return ERROR | @Trigger_Error(400);
		case 'array':
			break;
		default:
			return ERROR | @Trigger_Error(101);
		}
		#-------------------------------------------------------------------------------
		#-------------------------------------------------------------------------------
		$RowID = $Order['ID'];
		#-------------------------------------------------------------------------------
		$ModeID = SPrintF('%sOrders',$StrExpl[0]);
		#-------------------------------------------------------------------------------
	}
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
#Debug("[comp/Formats/Status/Name]: ModeID = $ModeID; StatusID = $StatusID; RowID = $RowID; Length = $Length");
#-------------------------------------------------------------------------------
$Name = $Config['Statuses'][$ModeID][$StatusID]['Name'];
#-------------------------------------------------------------------------------
if(!Is_Null($Length)){
	#-------------------------------------------------------------------------------
	$Name = Comp_Load('Formats/String',$Name,$Length);
	if(Is_Error($Name))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return new Tag(
               'NOBODY',
                new Tag(
                        'IMG',
                         Array(
                               'class'       => 'Button',
                               'onMouseOver' => 'PromptShow(event,\'История изменений\',this);',
                               'width'       => 16,
                               'height'      => 16,
                               'src'         => 'SRC:{Images/Icons/History.gif}',
                               'onclick'     => SPrintF("javascript:ShowWindow('/StatusesHistory',{ModeID:'%s',RowID:%u});",$ModeID,$RowID)
                               )
                       ),
                       new Tag('SPAN',$Name)
              );
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
?>
