<?php

#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('FileID','Scale','IsBorder');
/******************************************************************************/
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
if(Is_Error(System_Load('libs/Image.php')))
  return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
if(!Comp_IsLoaded('Clauses/Image')){
  #-----------------------------------------------------------------------------
  $Links = &Links();
  # Коллекция ссылок
  $DOM = &$Links['DOM'];
  #-----------------------------------------------------------------------------
  $Script = new Tag('SCRIPT',Array('type'=>'text/javascript','src'=>'SRC:{Js/ClauseImage.js}'));
  #-----------------------------------------------------------------------------
  $DOM->AddChild('Head',$Script);
}
#-------------------------------------------------------------------------------
$Image = DB_Select('ClausesFiles',Array('ID','FileData','Comment'),Array('UNIQ','ID'=>$FileID));
#-------------------------------------------------------------------------------
switch(ValueOf($Image)){
  case 'error':
    return ERROR | @Trigger_Error(500);
  case 'exception':
    return new Tag('SPAN',SPrintF('Изображение не найдено (%s)',$FileID));
  break;
  case 'array':
    #---------------------------------------------------------------------------
    $Scale = Min(Max(50,$Scale),200);
    #---------------------------------------------------------------------------
    $Size = Image_Get_Size($Image['FileData']);
    if(Is_Error($Size))
      return ERROR | @Trigger_Error(500);
    #---------------------------------------------------------------------------
    $Index = $Size['Height']/$Size['Width'];
    #---------------------------------------------------------------------------
    $Width  = $Size['Width']*($Scale/100);
    $Height = $Width*$Index;
    #---------------------------------------------------------------------------
    $Img = new Tag('IMG',Array('border'=>0,'title'=>$Image['Comment'],'width'=>(integer)$Width,'height'=>(integer)$Height,'src'=>SPrintF('/ClauseImage?ImageID=%u&Scale=%u',$Image['ID'],$Scale)));
    #---------------------------------------------------------------------------
    if($IsBorder)
      $Img->AddAttribs(Array('style'=>'border:1px solid #DCDCDC;'));
    #---------------------------------------------------------------------------
    if($Scale != 100)
      $Img->AddAttribs(Array('onclick'=>SPrintF('ClauseImageShow(%u,this);',$Image['ID'])));
    #---------------------------------------------------------------------------
    return $Img;
  default:
    return ERROR | @Trigger_Error(101);
}
#-------------------------------------------------------------------------------

?>
