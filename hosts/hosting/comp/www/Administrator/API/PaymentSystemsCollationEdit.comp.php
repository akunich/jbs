<?php

#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru  */
/******************************************************************************/
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Args = Args();
#-------------------------------------------------------------------------------
$CollationID	= (integer) @$Args['CollationID'];
$Window		=  (string) @$Args['Window'];
$IsActive	= (boolean) @$Args['IsActive'];
$SortID		= (integer) @$Args['SortID'];
$Source		=  (string) @$Args['Source'];
$Destination	=  (string) @$Args['Destination'];
$Image		=  (string) @$Args['Image'];
$Prompt		=  (string) @$Args['Prompt'];
$Description	=  (string) @$Args['Description'];
$AdminNotice	=  (string) @$Args['AdminNotice'];
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
if(Is_Error(System_Load('modules/Authorisation.mod')))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
if(!$Source)
	return new gException('NO_SOURCE','Не указана исходная платёжная система');
#-------------------------------------------------------------------------------
if(!$Destination)
	return new gException('NO_DESTINATION','Не указана система оплаты');
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$UCollation = Array(
			'IsActive'	=> $IsActive,
			'Source'	=> $Source,
			'Destination'	=> $Destination,
			'Image'		=> $Image,
			'Prompt'	=> $Prompt,
			'Description'	=> $Description,
			'AdminNotice'	=> $AdminNotice,
			'SortID'	=> $SortID
		);
#-------------------------------------------------------------------------------
#-----------------------------TRANSACTION---------------------------------------
if(Is_Error(DB_Transaction($TransactionID = UniqID('CollationEdit'))))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Answer = Array('Status'=>'Ok');
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
if($CollationID){
	#-------------------------------------------------------------------------------
	$IsUpdate = DB_Update('PaymentSystemsCollation',$UCollation,Array('ID'=>$CollationID));
	if(Is_Error($IsUpdate))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
}else{
	#-------------------------------------------------------------------------------
	$CollationID = DB_Insert('PaymentSystemsCollation',$UCollation);
	if(Is_Error($CollationID))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	$Answer['CollationID'] = $CollationID;
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
if(Is_Error(DB_Commit($TransactionID)))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
if($Window){
	#-------------------------------------------------------------------------------
	$Window = JSON_Decode(Base64_Decode($Window),TRUE);
	#-------------------------------------------------------------------------------
	$Window['Args']['CollationID'] = $CollationID;
	#-------------------------------------------------------------------------------
	$Answer = Array('Status'=>'Window','Window'=>$Window);
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return $Answer;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
?>
