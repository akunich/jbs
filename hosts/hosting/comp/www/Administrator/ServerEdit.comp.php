<?php

#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('Args');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Args = IsSet($Args)?$Args:Args();
#-------------------------------------------------------------------------------
$ServerID	= (integer) @$Args['ServerID'];
$TemplateID	=  (string) @$Args['TemplateID'];
$TemplatesIDs	=  (string) @$Args['TemplatesIDs'];
$Window		=  (string) @$Args['Window'];
#-------------------------------------------------------------------------------
if(Is_Error(System_Load('modules/Authorisation.mod','classes/DOM.class.php','libs/Tree.php')))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$__USER = $GLOBALS['__USER'];
#-------------------------------------------------------------------------------
if($ServerID){
	#-------------------------------------------------------------------------------
	$Server = DB_Select('Servers',Array('*'),Array('UNIQ','ID'=>$ServerID));
	#-------------------------------------------------------------------------------
	switch(ValueOf($Server)){
	case 'error':
		return ERROR | @Trigger_Error(500);
	case 'exception':
		return ERROR | @Trigger_Error(400);
	case 'array':
		#-------------------------------------------------------------------------------
		$TemplateID = $Server['TemplateID'];
		#-------------------------------------------------------------------------------
		break;
		#-------------------------------------------------------------------------------
	default:
		return ERROR | @Trigger_Error(101);
	}
	#-------------------------------------------------------------------------------
}else{
	#-------------------------------------------------------------------------------
	$Server = Array(
			'ServersGroupID'	=> 0,
			'IsDefault'		=> TRUE,
			'IsActive'		=> TRUE,
			'SortID'		=> 10000,
			'Protocol'		=> 'ssl',
			'Address'		=> 'srv1.isp.su',
			'Port'			=> 443,
			'Login'			=> 'root',
			'Password'		=> '',
			'Monitoring'		=> "HTTP=80\nHTTPS=443\nFTP=21\nMySQL=3306\nSMTP=25\nPOP=110\nIMAP=143",
			'AdminNotice'		=> "Платформа: HP Proliant DL165 G7\nПроцессоры: 2x AMD Opteron 6238 Twelve Core (G34, 2600MHz, 16Mb, 12 ядер)\nОперативная память: DDR3, 2x4Gb + 4x2Gb, всего 16Gb\nRAID контроллер: 3Ware 9750-4I, 512Mb RAM\nЖёсткие диски: 4x Western Digital WD5003ABYX (собраны в RAID10)\nАдминистратор: Василий Алибабаевич\n\nДоступ к встроенной IP-KVM: 222.111.123.123/admin/cw4rf34n3"
			);
	#-------------------------------------------------------------------------------
	# надо подсовывать разные параметры по дефолту, в зависимости от выбранного шаблона
	switch($TemplateID){
	case 'Hosting':
		break;
	case 'VPS':
		#-------------------------------------------------------------------------------
		$Server['Address']	= 'vds01.isp.su';
		$Server['Monitoring']	= "HTTP=80\nHTTPS=443";
		#-------------------------------------------------------------------------------
		break;
		#-------------------------------------------------------------------------------
	case 'Domains':
		#-------------------------------------------------------------------------------
		$Server['Address']	= '';
		$Server['Login']	= '';
		$Server['Monitoring']	= "HTTP=80\nHTTPS=443";
		$Server['AdminNotice']	= '';
		#-------------------------------------------------------------------------------
		break;
		#-------------------------------------------------------------------------------
	case 'ISPsw':
		#-------------------------------------------------------------------------------
		$Server['Address']	= 'api.ispsystem.com';
		$Server['Login']	= 'vasiliy.alibabaevich';
		$Server['Monitoring']	= "HTTP=80\nHTTPS=443";
		$Server['AdminNotice']	= 'Используется специально созданная учётная запись';
		#-------------------------------------------------------------------------------
		break;
		#-------------------------------------------------------------------------------
	case 'EmailClient':
		#-------------------------------------------------------------------------------
		$Server['Protocol']	= 'tcp';
		$Server['Address']	= 'pop.yandex.ru';
		$Server['Port']		= 110;
		$Server['Login']	= 'admin@company.com';
		$Server['Monitoring']	= "POP3=110\nPOP3S=995\nIMAP4=143\nIMAP4S=993";
		$Server['AdminNotice']	= 'Используется та же учётная запись от которой шлёт сообщения биллинг';
		#-------------------------------------------------------------------------------
	case 'ICQ':
		#-------------------------------------------------------------------------------
		$Server['Address']	= 'login.icq.com';
		$Server['Port']		= 5190;
		$Server['Login']	= '0000000,1111111,2222222';
		$Server['Monitoring']	= "ICQ=5190";
		$Server['AdminNotice']	= 'Можно указать несколько UIN в поле "Логин" перечислив их через запятую. Для отсылки будет выбираться случайный из них. Пароль должен быть одинаковым.';
		#-------------------------------------------------------------------------------
		break;
		#-------------------------------------------------------------------------------
	case 'Jabber':
		#-------------------------------------------------------------------------------
		$Server['Protocol']	= 'ssl';
		$Server['Address']	= 'jabber.isp.su';
		$Server['Port']		= 5222;
		$Server['Login']	= 'jabber@isp.su';
		$Server['Monitoring']	= "Jabber=5222";
		$Server['AdminNotice']	= '';
		#-------------------------------------------------------------------------------
		break;
		#-------------------------------------------------------------------------------
	case 'SMS':
		#-------------------------------------------------------------------------------
		$Server['Protocol']	= 'tcp';
		$Server['Address']	= 'smspilot.ru';
		$Server['Port']		= 80;
		$Server['Login']	= 'vasiliy.alibabaevich';
		$Server['Monitoring']	= "HTTP=80";
		$Server['AdminNotice']	= '';
		#-------------------------------------------------------------------------------
		break;
		#-------------------------------------------------------------------------------
	case 'Default':
		#-------------------------------------------------------------------------------
		$Server['Protocol']	= 'ssl';
		$Server['Address']	= 'www.joonte.com';
		$Server['Port']		= 443;
		$Server['Login']	= 'vasiliy.alibabaevich';
		$Server['Monitoring']	= "HTTP=80\nHTTPS=443";
		$Server['AdminNotice']	= '';
		#-------------------------------------------------------------------------------
		break;
		#-------------------------------------------------------------------------------
	default:
		break;
	}
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$DOM = new DOM();
#-------------------------------------------------------------------------------
$Links = &Links();
# Коллекция ссылок
$Links['DOM'] = &$DOM;
#-------------------------------------------------------------------------------
if(Is_Error($DOM->Load('Window')))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$Config = Config();
#-------------------------------------------------------------------------------
$Form = new Tag('FORM',Array('name'=>'ServerEditForm','onsubmit'=>'return false;'));
#-------------------------------------------------------------------------------
if($Window){
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load(
			'Form/Input',
			Array(
				'name'  => 'Window',
				'type'  => 'hidden',
				'value' => $Window
				)
			);
	if(Is_Error($Comp))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	$Form->AddChild($Comp);
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
if(!$ServerID)
	$DOM->AddAttribs('Body',Array('onload'=>'SettingsUpdate();'));
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
if(!$TemplateID){
	#-------------------------------------------------------------------------------
	$DOM->AddText('Title','Новый сервер');
	#-------------------------------------------------------------------------------
	$Templates = $Config['Servers']['Templates'];
	#-------------------------------------------------------------------------------
	$Options = Array();
	#-------------------------------------------------------------------------------
	$TemplatesIDs = ($TemplatesIDs?Explode(',',$TemplatesIDs):Array());
	#-------------------------------------------------------------------------------
	foreach(Array_Keys($Templates) as $TemplateID){
		#-------------------------------------------------------------------------------
		if(Count($TemplatesIDs) && !In_Array($TemplateID,$TemplatesIDs))
			continue;
		#-------------------------------------------------------------------------------
		$Template = $Templates[$TemplateID];
		#-------------------------------------------------------------------------------
		if($Template['IsActive'])
			$Options[$TemplateID] = $Templates[$TemplateID]['Name'];
		#-------------------------------------------------------------------------------
	}
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	if(!Count($Options))
		return new gException('TEMPLATES_NOT_DEFINED','Шаблоны не определены');
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load('Form/Select',Array('name'=>'TemplateID','style'=>'width: 100%;'),$Options);
	if(Is_Error($Comp))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	$Table = Array(Array('Шаблон',$Comp));
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load(
			'Form/Input',
			Array(
				'onclick' => "ShowWindow('/Administrator/ServerEdit',FormGet(form));",
				'type'    => 'button',
				'value'   => 'Продолжить'
				)
			);
	if(Is_Error($Comp))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	$Table[] = $Comp;
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load('Tables/Standard',$Table);
	if(Is_Error($Comp))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	$Form->AddChild($Comp);
	#-------------------------------------------------------------------------------
}else{
	#-------------------------------------------------------------------------------
	$DOM->AddText('Title',SPrintF('%s: %s %s',($ServerID)?'Редактирование':'Добавление',$Config['Servers']['Templates'][$TemplateID]['Name'],$Server['Address']));
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	# строим массив параметров подстановки
	$Template = $Config['Servers']['Templates'][$TemplateID];
	#-------------------------------------------------------------------------------
	foreach(Array_Keys($Template) as $Key){
		#-------------------------------------------------------------------------------
		if(Is_Array($Template[$Key])){
			#-------------------------------------------------------------------------------
			$Script = Array('var Settings = {};');
			#-------------------------------------------------------------------------------
			foreach(Array_Keys($Template[$Key]) as $SystemID)
				$Script[] = SPrintF("Settings['%s'] = %s;",$SystemID,JSON_Encode($Template[$Key][$SystemID]['Settings']));
			#-------------------------------------------------------------------------------
			$Script[] = "function SettingsUpdate(){\nvar \$Form = document.forms['ServerEditForm'];\nvar \$System = Settings[\$Form.$Key.value];\nfor(var i in \$System)\n\$Form[i].value = \$System[i];\n}";
			#-------------------------------------------------------------------------------
			$DOM->AddChild('Head',new Tag('SCRIPT',Implode("\n",$Script)));
			#-------------------------------------------------------------------------------
		
		}
		#-------------------------------------------------------------------------------
	}
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load(
			'Form/Input',
			Array(
				'name'  => 'TemplateID',
				'type'  => 'hidden',
				'value' => $TemplateID
				)
			);
	if(Is_Error($Comp))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	$Form->AddChild($Comp);
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	$Table = Array();
	#-------------------------------------------------------------------------------
	$Table[] = 'Общие параметры';
	#-------------------------------------------------------------------------------
	$ServersGroups = DB_Select('ServersGroups',Array('ID','Name','(SELECT `Code` FROM `Services` WHERE `ServersGroups`.`ServiceID` = `Services`.`ID`) AS `Code`'));
	#-------------------------------------------------------------------------------
	switch(ValueOf($ServersGroups)){
	case 'error':
		return ERROR | @Trigger_Error(500);
	case 'exception':
		# No more...
		break;
	case 'array':
		# No more...
		break;
	default:
		return ERROR | @Trigger_Error(101);
	}
	#-------------------------------------------------------------------------------
	$Options = Array(0=>'Не входит в группу');
	#-------------------------------------------------------------------------------
	if(Is_Array($ServersGroups))
		foreach($ServersGroups as $ServersGroup)
			$Options[$ServersGroup['ID']] = SPrintF('[%s] %s',($ServersGroup['Code'])?$ServersGroup['Code']:'любой сервис',$ServersGroup['Name']);
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load('Form/Select',Array('name'=>'ServersGroupID','prompt'=>'Группа серверов, в которую входит сервер','style'=>'width: 100%;'),$Options,$Server['ServersGroupID']);
	if(Is_Error($Comp))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	$Table[] = Array('Группа серверов',$Comp);
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load('Form/Input',Array('name'=>'IsActive','type'=>'checkbox','value'=>'yes'));
	if(Is_Error($Comp))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	if($Server['IsActive'])
		$Comp->AddAttribs(Array('checked'=>'yes'));
	#-------------------------------------------------------------------------------
	$Table[] = Array(new Tag('SPAN',Array('style'=>'cursor:pointer;','onclick'=>'ChangeCheckBox(\'IsActive\'); return false;'),'Активен'),$Comp);
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load('Form/Input',Array('name'=>'IsDefault','type'=>'checkbox','value'=>'yes'));
	if(Is_Error($Comp))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	if($Server['IsDefault'])
		$Comp->AddAttribs(Array('checked'=>'yes'));
	#-------------------------------------------------------------------------------
	$Table[] = Array(new Tag('SPAN',Array('style'=>'cursor:pointer;','onclick'=>'ChangeCheckBox(\'IsDefault\'); return false;'),'Основной в группе'),$Comp);
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load(
			'Form/Input',
			Array(
				'type'          => 'text',
				'name'          => 'SortID',
				'style'         => 'width: 100%;',
				'value'         => $Server['SortID'],
				'prompt'        => 'В каком порядке сортировать группы, при отображении'
				)
			);
	if(Is_Error($Comp))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	$Table[] = Array('Порядок сортировки',$Comp);
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	$Table[] = 'Параметры соединения';
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load('Form/Select',Array('name'=>'Protocol','style'=>'width: 100%;'),Array('ssl'=>'ssl','tcp'=>'tcp'),$Server['Protocol']);
	if(Is_Error($Comp))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	$Table[] = Array('Протокол',$Comp);
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load(
			'Form/Input',
			Array(
				'class'	=> 'Duty',
				'type'	=> 'text',
				'name'	=> 'Address',
				'prompt'=> 'Используется для связи с сервером',
				'value'	=> $Server['Address'],
				'style'	=> 'width: 100%;',
				)
			);
	if(Is_Error($Comp))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	$Table[] = Array('Адрес сервера',$Comp);
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load(
			'Form/Input',
			Array(
				'class'	=> 'Duty',
				'type'  => 'text',
				'name'  => 'Port',
				'prompt'=> 'Порт на который устанавливать соединение с сервером (для SSL - обычно 443, для HTTP - 80)',
				'value' => $Server['Port'],
				'style' => 'width: 100%;',
				)
			);
	if(Is_Error($Comp))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	$Table[] = Array('Порт',$Comp);
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load(
			'Form/Input',
			Array(
				'type'	=> 'text',
				'class'	=> 'Duty',
				'prompt'=> 'Имя администратора или реселлера имеющего права на создание новых клиентов, на сервере, через систему управления',
				'name'	=> 'Login',
				'value'	=> $Server['Login'],
				'style' => 'width: 100%;',
				)
			);
	if(Is_Error($Comp))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	$Table[] = Array('Логин',$Comp);
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load(
			'Form/Input',
			Array(
				'class' => 'Duty',
				'type'  => ($ServerID?'password':'text'),
				'name'  => 'Password',
				'value' => $Server['Password'],
				'style' => 'width: 100%;',
				)
			);
	if(Is_Error($Comp))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	$Table[] = Array('Пароль',$Comp);
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	if($ServerID){
		#-------------------------------------------------------------------------------
		$Comp = Comp_Load(
				'Form/Input',
				Array(
					'name'  => 'ServerID',
					'type'  => 'hidden',
					'value' => $Server['ID'],
					'style' => 'width: 100%;',
					)
				);
		if(Is_Error($Comp))
			return ERROR | @Trigger_Error(500);
		#-------------------------------------------------------------------------------
		$Form->AddChild($Comp);
		#-------------------------------------------------------------------------------
	}
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	$Template = System_XML(SPrintF('servers/%s.xml',$TemplateID));
	if(Is_Error($Template))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	if(IsSet($Template['Attribs'])){
		#-------------------------------------------------------------------------------
		$Attribs = $Template['Attribs'];
		#-------------------------------------------------------------------------------
		#-------------------------------------------------------------------------------
		$Replace = Array_ToLine($__USER,'%');
		#-------------------------------------------------------------------------------
		foreach(Array_Keys($Attribs) as $AttribID){
			#-------------------------------------------------------------------------------
			$Attrib = $Attribs[$AttribID];
			#-------------------------------------------------------------------------------
			if(IsSet($Attrib['Title']))
				$Table[] = $Attrib['Title'];
			#-------------------------------------------------------------------------------
			if($ServerID){
				#-------------------------------------------------------------------------------
				$Value = (string)@$Server['Params'][$AttribID];
				#-------------------------------------------------------------------------------
			}else{
				#-------------------------------------------------------------------------------
				$Value = $Attrib['Value'];
				#-------------------------------------------------------------------------------
				foreach(Array_Keys($Replace) as $Key)
					$Value = Str_Replace($Key,$Replace[$Key],$Value);
				#-------------------------------------------------------------------------------
			}
			#-------------------------------------------------------------------------------
			#-------------------------------------------------------------------------------
			$Params = &$Attrib['Attribs'];
			#-------------------------------------------------------------------------------
			$Params['name'] = $AttribID;
			#-------------------------------------------------------------------------------
			if($Attrib['IsDuty'])
				$Params['class'] = 'Duty';
			#-------------------------------------------------------------------------------
			switch($Attrib['Type']){
			case 'Input':
				#-------------------------------------------------------------------------------
				$Params['value'] = $Value;
				#-------------------------------------------------------------------------------
				# костыль для чекбоксов - у них всегда одно значение
				if(IsSet($Attrib['Attribs']['type']) && $Attrib['Attribs']['type'] == 'checkbox')
					$Params['value'] = 'yes';
				#-------------------------------------------------------------------------------
				$Comp = Comp_Load('Form/Input',$Params);
				if(Is_Error($Comp))
					return ERROR | @Trigger_Error(101);
				#-------------------------------------------------------------------------------
				# костыль для чекбоксов - у них дополнительный параметр "checked", если задано значение
				if(IsSet($Attrib['Attribs']['type']) && $Attrib['Attribs']['type'] == 'checkbox' && $Value)
					$Comp->AddAttribs(Array('checked'=>'yes'));
				#-------------------------------------------------------------------------------
				break;
				#-------------------------------------------------------------------------------
			case 'TextArea':
				#-------------------------------------------------------------------------------
				$Comp = Comp_Load('Form/TextArea',$Params,$Value);
				if(Is_Error($Comp))
					return ERROR | @Trigger_Error(101);
				#-------------------------------------------------------------------------------
				break;
				#-------------------------------------------------------------------------------
			case 'Select':
				#-------------------------------------------------------------------------------
				$Comp = Comp_Load('Form/Select',$Params,$Attrib['Options'],$Value);
				if(Is_Error($Comp))
					return ERROR | @Trigger_Error(101);
				#-------------------------------------------------------------------------------
				break;
				#-------------------------------------------------------------------------------
			case 'Hidden':
				#-------------------------------------------------------------------------------
				$Params['value'] = $Value;
				#-------------------------------------------------------------------------------
				$Params['type'] = 'hidden';
				#-------------------------------------------------------------------------------
				$Comp = Comp_Load('Form/Input',$Params);
				if(Is_Error($Comp))
					return ERROR | @Trigger_Error(101);
				#-------------------------------------------------------------------------------
				break;
				#-------------------------------------------------------------------------------

			default:
				return ERROR | @Trigger_Error(101);
			}
			#-------------------------------------------------------------------------------
			#-------------------------------------------------------------------------------
			if($Attrib['Type'] == 'Hidden'){
				#-------------------------------------------------------------------------------
				$Form->AddChild($Comp);
				#-------------------------------------------------------------------------------
			}else{
				#-------------------------------------------------------------------------------
				$NoBody = new Tag('NOBODY',new Tag('SPAN',(IsSet($Attrib['CommentAttribs'])?$Attrib['CommentAttribs']:Array()),$Attrib['Comment']));
				#-------------------------------------------------------------------------------
				$NoBody->AddChild(new Tag('BR'));
				#-------------------------------------------------------------------------------
				if(IsSet($Attrib['Example']))
					$NoBody->AddChild(new Tag('SPAN',Array('class'=>'Comment'),SPrintF('Например: %s',$Attrib['Example'])));
				#-------------------------------------------------------------------------------
				$Table[] = Array($NoBody,$Comp);
				#-------------------------------------------------------------------------------
			}
			#-------------------------------------------------------------------------------
		}
		#-------------------------------------------------------------------------------
	}
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	$Table[] = 'Служба мониторинга';
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load(
			'Form/TextArea',
			Array(
				'name'		=> 'Monitoring',
				'style'		=> 'width:100%;',
				'rows'		=> 5,
				'prompt'	=> 'Сервисы которые необходимо мониторить на данном сервере'
				),
			$Server['Monitoring']
			);
	if(Is_Error($Comp))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	$Table[] = Array('Сервисы',$Comp);
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	$Table[] = 'Заметка';
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load(
			'Form/TextArea',
			Array(
				'name'		=> 'AdminNotice',
				'style'		=> 'width:100%;',
				'rows'		=> 5,
				'prompt'	=> 'Информация о сервере, "чисто для себя"'
				),
			$Server['AdminNotice']
			);
	if(Is_Error($Comp))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	$Table[] = $Comp;
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load(
			'Form/Input',
			Array(
				'type'    => 'button',
				'onclick' => SPrintF("FormEdit('/Administrator/API/ServerEdit','ServerEditForm','%s');",($ServerID?'Сохранение настроек':'Добавление сервера')),
				'value'   => ($ServerID?'Сохранить':'Добавить сервер')
				)
			);
	if(Is_Error($Comp))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	$Table[] = $Comp;
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load('Tables/Standard',$Table,Array('style'=>'width:500px;'));
	if(Is_Error($Comp))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	$Form->AddChild($Comp);
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$DOM->AddChild('Into',$Form);
#-------------------------------------------------------------------------------
if(Is_Error($DOM->Build(FALSE)))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return Array('Status'=>'Ok','DOM'=>$DOM->Object);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
?>
