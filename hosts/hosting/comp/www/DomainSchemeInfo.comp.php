<?php

#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
if(Is_Error(System_Load('modules/Authorisation.mod','classes/DOM.class.php')))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$Args = Args();
#-------------------------------------------------------------------------------
$DomainSchemeID = (string) @$Args['DomainSchemeID'];
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Columns = Array('*','(SELECT `Params` FROM `Servers` WHERE `ServerID` = `Servers`.`ID`) as `Attribs`');
#-------------------------------------------------------------------------------
$DomainScheme = DB_Select('DomainSchemes',$Columns,Array('UNIQ','ID'=>$DomainSchemeID));
#-------------------------------------------------------------------------------
switch(ValueOf($DomainScheme)){
case 'error':
	return ERROR | @Trigger_Error(500);
case 'exception':
	return ERROR | @Trigger_Error(400);
case 'array':
	break;
default:
	return ERROR | @Trigger_Error(101);
}


Debug(print_r($DomainScheme,true));

#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$DOM = new DOM();
#-------------------------------------------------------------------------------
$Links = &Links();
# Коллекция ссылок
$Links['DOM'] = &$DOM;
#-------------------------------------------------------------------------------
if(Is_Error($DOM->Load('Window')))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$DOM->AddText('Title',SPrintF('Параметры тарифа для доменной зоны ".%s"',$DomainScheme['Name']));
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Table = Array('Общая информация');
#-------------------------------------------------------------------------------
$Table[] = Array('Доменная зона',$DomainScheme['Name']);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Table[] = Array('Регистратор',$DomainScheme['Attribs']['Name']);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Comp = Comp_Load('Formats/Logic',$DomainScheme['IsActive']);
if(Is_Error($Comp))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$Table[] = Array('Тариф активен',$Comp);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Comp = Comp_Load('Formats/Logic',$DomainScheme['IsProlong']);
if(Is_Error($Comp))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$Table[] = Array('Возможность продления',$Comp);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Comp = Comp_Load('Formats/Logic',$DomainScheme['IsTransfer']);
if(Is_Error($Comp))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$Table[] = Array('Возможность переноса',$Comp);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Table[] = 'Цены';
#-------------------------------------------------------------------------------
$Comp = Comp_Load('Formats/Currency',$DomainScheme['CostOrder']);
if(Is_Error($Comp))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$Table[] = Array('Стоимость регистрации',$Comp);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Comp = Comp_Load('Formats/Currency',$DomainScheme['CostProlong']);
if(Is_Error($Comp))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$Table[] = Array('Стоимость продления',$Comp);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Comp = Comp_Load('Formats/Currency',$DomainScheme['CostTransfer']);
if(Is_Error($Comp))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$Table[] = Array('Стоимость переноса',$Comp);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Table[] = 'Ограничения';
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Table[] = Array('Минимальное кол-во лет заказа',$DomainScheme['MinOrderYears']);
#-------------------------------------------------------------------------------
$Table[] = Array('Максимальное кол-во лет делегирования',$DomainScheme['MaxActionYears']);
#-------------------------------------------------------------------------------
$Table[] = Array('Кол-во дней до продления',$DomainScheme['DaysToProlong']);
#-------------------------------------------------------------------------------
if($DomainScheme['MaxOrders'] > 0)
	$Table[] = Array('Максимальное число заказов',$DomainScheme['MaxOrders']);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
if($GLOBALS['__USER']['IsAdmin'] && IsSet($DomainScheme['Params']['curr'])){
	#-------------------------------------------------------------------------------
	$Table[] = 'Данные полученные от регистратора';
	#-------------------------------------------------------------------------------
	$Table[] = Array('Используемая валюта',$DomainScheme['Params']['curr']);
	$Table[] = Array('Стоимость регистрации',$DomainScheme['Params']['new']);
	$Table[] = Array('Стоимость продления',$DomainScheme['Params']['renew']);
	$Table[] = Array('Минимальный период',$DomainScheme['Params']['min.period']);
	$Table[] = Array('Максимальный период',$DomainScheme['Params']['max.period']);
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Comp = Comp_Load('Tables/Standard',$Table);
if(Is_Error($Comp))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$DOM->AddChild('Into',$Comp);
#-------------------------------------------------------------------------------
if(Is_Error($DOM->Build(FALSE)))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return Array('Status'=>'Ok','DOM'=>$DOM->Object);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

?>
