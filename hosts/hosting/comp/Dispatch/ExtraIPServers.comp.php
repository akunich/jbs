<?php


#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('IsSearch');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$ExtraIPs = DB_Select('ExtraIPs',Array('ID','Address'),Array('SortOn'=>'Address'));
#-------------------------------------------------------------------------------
switch(ValueOf($ExtraIPs)){
  case 'error':
    return ERROR | @Trigger_Error(500);
  case 'exception':
    return FALSE;
  case 'array':
    #---------------------------------------------------------------------------
    $Filters = Array('Сервера размещения');
    #---------------------------------------------------------------------------
    foreach($ExtraIPs as $ExtraIPServer){
      #-------------------------------------------------------------------------
      $Filter = Array('Name'=>$ExtraIPServer['Address'],'UsersIDs'=>Array());
      #-------------------------------------------------------------------------
      if($IsSearch){
        #-----------------------------------------------------------------------
        $ExtraIPOrders = DB_Select('ExtraIPOrdersOwners','UserID',Array('Where'=>SPrintF('`ServerID` = %u',$ExtraIPServer['ID'])));
        #-----------------------------------------------------------------------
        switch(ValueOf($ExtraIPOrders)){
          case 'error':
            return ERROR | @Trigger_Error(500);
          case 'exception':
            # No more...
          break;
          case 'array':
            #-------------------------------------------------------------------
            $UsersIDs = Array();
            #-------------------------------------------------------------------
            foreach($ExtraIPOrders as $ExtraIPOrder)
              $UsersIDs[] = $ExtraIPOrder['UserID'];
            #-------------------------------------------------------------------
            $UsersIDs = Array_Unique($UsersIDs);
            #-------------------------------------------------------------------
            $Filter['UsersIDs'] = $UsersIDs;
          break;
          default:
            return ERROR | @Trigger_Error(101);
        }
      }
      #-------------------------------------------------------------------------
      $Filters[$ExtraIPServer['Address']] = $Filter;
    }
    #---------------------------------------------------------------------------
    return $Filters;
  default:
    return ERROR | @Trigger_Error(101);
}
#-------------------------------------------------------------------------------

?>
