<?php

#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('IsSearch');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Orders = DB_Select('OrdersOwners',Array('ID','UserID','StatusID','(SELECT `Address` FROM `Servers` WHERE `Servers`.`ID` = `OrdersOwners`.`ServerID`) AS `Address`'),Array('SortOn'=>Array('ServiceID','Address')));
#-------------------------------------------------------------------------------
switch(ValueOf($Orders)){
case 'error':
	return ERROR | @Trigger_Error(500);
case 'exception':
	return FALSE;
case 'array':
	break;
default:
	return ERROR | @Trigger_Error(101);
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
# get config values
$Config = Config();
#-------------------------------------------------------------------------------
$Statuses = $Config['Statuses']['DomainOrders'];
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Filters = Array('Name'=>'Статусы заказов');
#-------------------------------------------------------------------------------
foreach($Orders as $Order){
	#-------------------------------------------------------------------------------
	if(Is_Null($Order['StatusID']))
		continue;
	#-------------------------------------------------------------------------------  $Array[$StatusID] = $Statuses[$TypeID][$StatusID]['Name'];
	if(!IsSet($Filters[$Order['StatusID']]))
		$Filters[$Order['StatusID']] = Array('Name'=>IsSet($Statuses[$Order['StatusID']])?$Statuses[$Order['StatusID']]['Name']:$Order['StatusID'],'UsersIDs'=>Array());
	#-------------------------------------------------------------------------------
	if($IsSearch)
		if(!In_Array($Order['UserID'],$Filters[$Order['StatusID']]['UsersIDs']))
			$Filters[$Order['StatusID']]['UsersIDs'][] = $Order['UserID'];
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return $Filters;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

?>
