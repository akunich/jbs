<?php

#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('IsSearch');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$VPSServers = DB_Select('VPSServers',Array('ID','Address'),Array('SortOn'=>'Address'));
#-------------------------------------------------------------------------------
switch(ValueOf($VPSServers)){
  case 'error':
    return ERROR | @Trigger_Error(500);
  case 'exception':
    return FALSE;
  case 'array':
    #---------------------------------------------------------------------------
    $Filters = Array('Сервера размещения, VPS');
    #---------------------------------------------------------------------------
    foreach($VPSServers as $VPSServer){
      #-------------------------------------------------------------------------
      $Filter = Array('Name'=>$VPSServer['Address'],'UsersIDs'=>Array());
      #-------------------------------------------------------------------------
      if($IsSearch){
        #-----------------------------------------------------------------------
        $VPSOrders = DB_Select('VPSOrdersOwners','UserID',Array('Where'=>SPrintF('`ServerID` = %u',$VPSServer['ID'])));
        #-----------------------------------------------------------------------
        switch(ValueOf($VPSOrders)){
          case 'error':
            return ERROR | @Trigger_Error(500);
          case 'exception':
            # No more...
          break;
          case 'array':
            #-------------------------------------------------------------------
            $UsersIDs = Array();
            #-------------------------------------------------------------------
            foreach($VPSOrders as $VPSOrder)
              $UsersIDs[] = $VPSOrder['UserID'];
            #-------------------------------------------------------------------
            $UsersIDs = Array_Unique($UsersIDs);
            #-------------------------------------------------------------------
            $Filter['UsersIDs'] = $UsersIDs;
          break;
          default:
            return ERROR | @Trigger_Error(101);
        }
      }
      #-------------------------------------------------------------------------
      $Filters[$VPSServer['Address']] = $Filter;
    }
    #---------------------------------------------------------------------------
    return $Filters;
  default:
    return ERROR | @Trigger_Error(101);
}
#-------------------------------------------------------------------------------


?>
