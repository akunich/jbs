<?php

#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('IsSearch');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Orders = DB_Select('OrdersOwners',Array('ID','UserID','StatusID','(SELECT `Address` FROM `Servers` WHERE `Servers`.`ID` = `OrdersOwners`.`ServerID`) AS `Address`'),Array('SortOn'=>Array('ServiceID','Address')));
#-------------------------------------------------------------------------------
switch(ValueOf($Orders)){
case 'error':
	return ERROR | @Trigger_Error(500);
case 'exception':
	return FALSE;
case 'array':
	break;
default:
	return ERROR | @Trigger_Error(101);
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
# get config values
$Config = Config();
#-------------------------------------------------------------------------------
$Statuses = $Config['Statuses']['DomainOrders'];
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Filters = Array('Name'=>'Сервера / Статусы');
#-------------------------------------------------------------------------------
foreach($Orders as $Order)
	if(!IsSet($Filters[$Order['StatusID']])){
		Debug(SPrintF('[comp/Dispatch/Servers]: OrderID = %u, StatusID = %s',$Order['ID'],$Order['StatusID']));
		$Filters[$Order['StatusID']] = Array('Name'=>IsSet($Statuses[$Order['StatusID']])?$Statuses[$Order['StatusID']]['Name']:$Order['StatusID'],'UsersIDs'=>Array());
	}

$Filters['Delimiter'] = '+ + +';
#-------------------------------------------------------------------------------
foreach($Orders as $Order){
	#-------------------------------------------------------------------------------
	if(Is_Null($Order['Address']))
		continue;
	#-------------------------------------------------------------------------------
	if(!IsSet($Filters[$Order['Address']])){
		#-------------------------------------------------------------------------------
		$Filters[$Order['Address']] = Array('Name'=>$Order['Address'],'UsersIDs'=>Array());
		#-------------------------------------------------------------------------------
		#foreach(Array_Keys($Statuses) as $StatusID)
		#	$Filters[$Order['Address']][$StatusID] = Array();
		#-------------------------------------------------------------------------------
	}
	#-------------------------------------------------------------------------------
	if($IsSearch){
		#-------------------------------------------------------------------------------
		#if(!In_Array($Order['UserID'],$Filters[$Order['Address']]['UsersIDs']))
		#	$Filters[$Order['Address']]['UsersIDs'][] = $Order['UserID'];
		#-------------------------------------------------------------------------------
	}
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return $Filters;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

?>
