<?php

#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('Params');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/

$ExtraIPOrders = DB_Select('ExtraIPOrdersOwners',Array('ID','OrderID','UserID'),Array('Where'=>Array('`StatusID` = "OnCreate"','`StatusDate` < UNIX_TIMESTAMP() - 24*3600')));
switch(ValueOf($ExtraIPOrders)){
case 'error':
	return ERROR | @Trigger_Error(500);
case 'exception':
	#-------------------------------------------------------------------------------
	Debug('[comp/Tasks/GC/ExtraIPCheckOnCreate]: нет зависших на создании IP адресов');
	#-------------------------------------------------------------------------------
	return TRUE;
	#-------------------------------------------------------------------------------
case 'array':
	break;
default:
	return ERROR | @Trigger_Error(101);
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
foreach($ExtraIPOrders as $ExtraIPOrder){
	#-------------------------------------------------------------------------------
	$Event = Array('UserID'=>$ExtraIPOrder['UserID'],'PriorityID'=>'Hosting','Text'=>SPrintF('Заказ IP адреса #%s не активирован более суток',$ExtraIPOrder['OrderID']));
	$Event = Comp_Load('Events/EventInsert',$Event);
	#-------------------------------------------------------------------------------
	if(!$Event)
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return TRUE;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

?>
