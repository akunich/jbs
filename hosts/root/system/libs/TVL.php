<?php
#-------------------------------------------------------------------------------
/** @author Бреславский А.В. (Joonte Ltd.) */
#-------------------------------------------------------------------------------
function TVL_Create($TVL){
  /****************************************************************************/
  $__args_types = Array('array');
  #-----------------------------------------------------------------------------
  $__args__ = Func_Get_Args(); Eval(FUNCTION_INIT);
  /****************************************************************************/
  $Result = '';
  #-----------------------------------------------------------------------------
  foreach(Array_Keys($TVL) as $WordID){
    #---------------------------------------------------------------------------
    $Word = $TVL[$WordID];
    #---------------------------------------------------------------------------
    if(!Is_Array($Word))
      $Size = StrLen($Word);
    else
      $Word = Bytes_I2B($Size = Next($Word),Prev($Word));
    #---------------------------------------------------------------------------
    $Result .= Bytes_I2B(WORD,HexDec($WordID)). # Тип
               Bytes_I2B(WORD,$Size). # Длина
               $Word; # Значение
  }
  #-----------------------------------------------------------------------------
  return $Result;
}
#-------------------------------------------------------------------------------
function TVL_Explode($String,&$Array = Array()){
  /****************************************************************************/
  $__args_types = Array('string','array');
  #-----------------------------------------------------------------------------
  $__args__ = Func_Get_Args(); Eval(FUNCTION_INIT);
  /****************************************************************************/
  $Length = HexDec(Bytes_Get($String,02,WORD));
  #-----------------------------------------------------------------------------
  $Array[Bytes_Get($String,00,WORD)] = SubStr($String,04,$Length);
  #-----------------------------------------------------------------------------
  if(StrLen($String = SubStr($String,04 + $Length)) > 0)
    TVL_Explode($String,$Array);
  #-----------------------------------------------------------------------------
  return $Array;
}
#-------------------------------------------------------------------------------
?>