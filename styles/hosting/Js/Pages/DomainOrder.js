//------------------------------------------------------------------------------
/** @author Бреславский А.В. (Joonte Ltd.) */
//------------------------------------------------------------------------------
function TrimDomainName(Field){
  //----------------------------------------------------------------------------
  var $Index = Field.value.indexOf('.');
  //----------------------------------------------------------------------------
  if($Index != -1)
    Field.value = Field.value.substring(0,$Index);
  //----------------------------------------------------------------------------
  return null;
}
//------------------------------------------------------------------------------
function SetNs(){
  //----------------------------------------------------------------------------
  var $Form = document.forms['DomainOrderForm'];
  //----------------------------------------------------------------------------
  var $HostingOrderID = $Form.HostingOrderID.value;
  //----------------------------------------------------------------------------
  var $HostingOrders = HostingOrders[$HostingOrderID];
  //----------------------------------------------------------------------------
  for(var $i=1;$i<5;$i++){
    //--------------------------------------------------------------------------
    var $Name = SPrintF('Ns%uName',$i);
    //--------------------------------------------------------------------------
    if($HostingOrders[$Name])
      $Form[$Name].value = $HostingOrders[$Name];
    //--------------------------------------------------------------------------
    $Form[$Name].readonly = Number($HostingOrderID);
  }
}
//------------------------------------------------------------------------------
function IsNewNs(){
  //----------------------------------------------------------------------------
  var $Form = document.forms['DomainOrderForm'];
  //----------------------------------------------------------------------------
  var $DomainZone = $Form.DomainZone.value;
  //----------------------------------------------------------------------------
  for(var $i=1;$i<5;$i++){
    //--------------------------------------------------------------------------
    var $DnsName = $Form[SPrintF('Ns%uName',$i)].value;
    //--------------------------------------------------------------------------
    $Form[SPrintF('Ns%uIP',$i)].disabled = ($Form.DomainName.value+'.'+$DomainZone != $DnsName.substring($DnsName.indexOf('.') + 1,$DnsName.length));
  }
}
//------------------------------------------------------------------------------
function DomainOrder(){
  //----------------------------------------------------------------------------
  var $Form = document.forms['DomainOrderForm'];
  //----------------------------------------------------------------------------
  $HTTP = new HTTP();
  //----------------------------------------------------------------------------
  if(!$HTTP.Resource){
    //--------------------------------------------------------------------------
    alert('Не удалось создать HTTP соединение');
    //--------------------------------------------------------------------------
    return false;
  }
  //----------------------------------------------------------------------------
  $HTTP.onLoaded = function(){
    //--------------------------------------------------------------------------
    HideProgress();
  }
  //----------------------------------------------------------------------------
  $HTTP.onAnswer = function($Answer){
    //--------------------------------------------------------------------------
    switch($Answer.Status){
      case 'Error':
        ShowAlert($Answer.Error.String,'Warning');
      break;
      case 'Exception':
        ShowAlert(ExceptionsStack($Answer.Exception),'Warning');
      break;
      case 'Ok':
        ShowWindow('/DomainOrderPay',{DomainOrderID:$Answer.DomainOrderID});
      break;
      default:
        alert('Не известный ответ');
    }
  }
  //----------------------------------------------------------------------------
  var $Args = FormGet($Form);
  //----------------------------------------------------------------------------
  if(!$HTTP.Send('/API/DomainOrder',$Args)){
    //--------------------------------------------------------------------------
    alert('Не удалось отправить запрос на сервер');
    //--------------------------------------------------------------------------
    return false;
  }
  //----------------------------------------------------------------------------
  ShowProgress('Обработка заявки на заказ');
}