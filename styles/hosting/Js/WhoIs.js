//------------------------------------------------------------------------------
/** @author Бреславский А.В. (Joonte Ltd.) */
//------------------------------------------------------------------------------
function WhoIs(){
  //----------------------------------------------------------------------------
  var $Form = document.forms['WhoIsForm'];
  //----------------------------------------------------------------------------
  var $HTTP = new HTTP();
  //----------------------------------------------------------------------------
  if(!$HTTP.Resource){
    //--------------------------------------------------------------------------
    alert('Не удалось создать HTTP соединение');
    //--------------------------------------------------------------------------
    return false;
  }
  //----------------------------------------------------------------------------
  $HTTP.onLoaded = function(){
    //--------------------------------------------------------------------------
    HideProgress();
  }
  //----------------------------------------------------------------------------
  $HTTP.onAnswer = function($Answer){
    //--------------------------------------------------------------------------
    var $WhoIsInfo = document.getElementById('WhoIsInfo');
    //--------------------------------------------------------------------------
    $WhoIsInfo.innerHTML = '';
    //--------------------------------------------------------------------------
    switch($Answer.Status){
      case 'Error':
        ShowAlert($Answer.Error.String,'Warning');
      break;
      case 'Fail':
        ShowAlert('Ошибка определения домена','Warning');
      break;
      case 'Exception':
        ShowAlert(ExceptionsStack($Answer.Exception),'Warning');
      break;
      case 'Borrowed':
        //----------------------------------------------------------------------
        var $ExpirationDate = $Answer.ExpirationDate;
        //----------------------------------------------------------------------
        if($ExpirationDate){
          //--------------------------------------------------------------------
          var $Date = new Date($Answer.ExpirationDate*1000).ToStringDate();
          //--------------------------------------------------------------------
          $WhoIsInfo.innerHTML += SPrintF('<H2>Дата окончания: %s</H2>',$Date);
        }
        //----------------------------------------------------------------------
        var $Ul = '<UL class="Standard">';
        //----------------------------------------------------------------------
        for(var $i=1;$i<10;$i++){
          //--------------------------------------------------------------------
          $NsName = $Answer[SPrintF('Ns%uName',$i)];
          //--------------------------------------------------------------------
          if($NsName)
            $Ul += SPrintF('<LI>%s',$NsName);
          //--------------------------------------------------------------------
          $NsIP = $Answer[SPrintF('Ns%uIP',$i)];
          //--------------------------------------------------------------------
          if($NsIP)
            $Ul += SPrintF(' %s',$NsIP);
          //--------------------------------------------------------------------
          $Ul += '</LI>';
        }
        //----------------------------------------------------------------------
        $WhoIsInfo.innerHTML += SPrintF('%s</UL>',$Ul);
        //----------------------------------------------------------------------
        $WhoIsInfo.innerHTML += SPrintF('<PRE class="Standard">%s</PRE>',$Answer.Info);
        //----------------------------------------------------------------------
      break;
      case 'Free':
        ShowAlert('Доменное имя свободно');
      break;
      default:
        alert('Не известный ответ');
    }
  };
  //----------------------------------------------------------------------------
  var $Args = FormGet($Form);
  //----------------------------------------------------------------------------
  if(!$HTTP.Send('/API/WhoIs',$Args)){
    //--------------------------------------------------------------------------
    alert('Не удалось отправить запрос на сервер');
    //--------------------------------------------------------------------------
    return false;
  }
  //----------------------------------------------------------------------------
  ShowProgress('Проверка домена');
}