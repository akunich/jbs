//------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
function TicketAddMessage(){
  //----------------------------------------------------------------------------
  var $Form = document.forms['TicketReadForm'];
  //----------------------------------------------------------------------------
  $HTTP = new HTTP();
  //----------------------------------------------------------------------------
  if(!$HTTP.Resource){
    //--------------------------------------------------------------------------
    alert('Не удалось создать HTTP соединение');
    //--------------------------------------------------------------------------
    return false;
  }
  //----------------------------------------------------------------------------
  $HTTP.onLoaded = function(){
    //--------------------------------------------------------------------------
    HideProgress();
  }
  //----------------------------------------------------------------------------
  $HTTP.onAnswer = function($Answer){
    //--------------------------------------------------------------------------
    switch($Answer.Status){
      case 'Error':
        ShowAlert($Answer.Error.String,'Warning');
      break;
      case 'Exception':
        ShowAlert(ExceptionsStack($Answer.Exception),'Warning');
      break;
      case 'Ok':
        //----------------------------------------------------------------------
        var $Form = document.forms['TicketReadForm'];
        //----------------------------------------------------------------------
        if($Form.IsNext){
          //--------------------------------------------------------------------
          if($Form.IsNext.checked){
            //------------------------------------------------------------------
            ShowWindow('/TicketRead',{TicketID:$Form.IsNext.value});
            //------------------------------------------------------------------
            break;
          }
        }
        //----------------------------------------------------------------------
	if($Form.Flags.selectedIndex){
		var Selected = $Form.Flags.selectedIndex;
		var SelectedOption = $Form.Flags.options[Selected].value;
		if(SelectedOption != "No"){
			var close = "yes";
		}else{
			var close = "no";
		}
	}else{
		if($Form.Flags.checked){
			var close = "yes";
		}else{
			var close = "no";
		}
	}
        if(close == "yes"){
          GetURL(document.location);
        }else{
          //--------------------------------------------------------------------
          document.forms['TicketReadForm'].Message.value = '';
          //--------------------------------------------------------------------
          UploadDelete('TicketReadForm','TicketMessageFile');
          //--------------------------------------------------------------------
          document.getElementById('TicketReadMessages').contentWindow.document.location.reload();
        }
      break;
      default:
        alert('Не известный ответ');
    }
  }
  //----------------------------------------------------------------------------
  var $Args = FormGet($Form);
  //----------------------------------------------------------------------------
  if(!$HTTP.Send('/API/TicketMessageEdit',$Args)){
    //--------------------------------------------------------------------------
    alert('Не удалось отправить запрос на сервер');
    //--------------------------------------------------------------------------
    return false;
  }
  //----------------------------------------------------------------------------
  ShowProgress('Добавление сообщения в запрос');
}
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------

