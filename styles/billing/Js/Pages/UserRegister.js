//------------------------------------------------------------------------------
/** @author Бреславский А.В. (Joonte Ltd.) */
//------------------------------------------------------------------------------
function PasswordMode(){
  //----------------------------------------------------------------------------
  var $Form = document.forms['UserRegisterForm'];
  //----------------------------------------------------------------------------
  with($Form){
    //--------------------------------------------------------------------------
    if(IsPasswordCreate.checked){
      //------------------------------------------------------------------------
      Password.value = IsPasswordCreate.value;
      Password.disabled = true;
    }else{
      //------------------------------------------------------------------------
      Password.value = '';
      Password.disabled = false;
    }
    //--------------------------------------------------------------------------
    _Password.value = Password.value;
    _Password.disabled = Password.disabled;
  }
}
//------------------------------------------------------------------------------
function UserRegister(){
  //----------------------------------------------------------------------------
  $Form = document.forms['UserRegisterForm'];
  //----------------------------------------------------------------------------
  $HTTP = new HTTP();
  //----------------------------------------------------------------------------
  if(!$HTTP.Resource){
    //--------------------------------------------------------------------------
    alert('Не удалось создать HTTP соединение');
    //--------------------------------------------------------------------------
    return false;
  }
  //----------------------------------------------------------------------------
  $HTTP.onLoaded = function(){
    //--------------------------------------------------------------------------
    HideProgress();
  }
  //----------------------------------------------------------------------------
  $HTTP.onAnswer = function($Answer){
    //--------------------------------------------------------------------------
    switch($Answer.Status){
      case 'Error':
        ShowAlert($Answer.Error.String,'Warning');
      break;
      case 'Exception':
        //----------------------------------------------------------------------
        var $Protect = document.getElementById('Protect');
        //----------------------------------------------------------------------
        if($Protect)
          $Protect.src = '/Protect?Rand=' + (Math.round(Math.random()*8999) + 1000);
        //----------------------------------------------------------------------
        ShowAlert(ExceptionsStack($Answer.Exception),'Warning');
      break;
      case 'Ok':
        GetURL($Answer.Home);
      break;
      default:
        alert('Не известный ответ');
    }
  }
  //----------------------------------------------------------------------------
  var $Args = FormGet($Form);
  //----------------------------------------------------------------------------
  if(!$HTTP.Send('/API/UserRegister',$Args)){
    //--------------------------------------------------------------------------
    alert('Не удалось отправить запрос на сервер');
    //--------------------------------------------------------------------------
    return false;
  }
  //----------------------------------------------------------------------------
  ShowProgress('Регистрация в системе');
}