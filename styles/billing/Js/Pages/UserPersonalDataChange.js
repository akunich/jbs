//------------------------------------------------------------------------------
/** @author Бреславский А.В. (Joonte Ltd.) */
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
function UserPersonalDataChange() {
	//------------------------------------------------------------------------------
	var $Form = document.forms['UserPersonalDataChangeForm'];
	//------------------------------------------------------------------------------
	$HTTP = new HTTP();
	//------------------------------------------------------------------------------
	if (!$HTTP.Resource) {
		//------------------------------------------------------------------------------
		alert('Не удалось создать HTTP соединение');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	$HTTP.onLoaded = function() {
		//------------------------------------------------------------------------------
		HideProgress();
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	$HTTP.onAnswer = function($Answer) {
		//------------------------------------------------------------------------------
		switch ($Answer.Status) {
		case 'Error':
			//------------------------------------------------------------------------------
			ShowAlert($Answer.Error.String, 'Warning');
			//------------------------------------------------------------------------------
			break;
			//------------------------------------------------------------------------------
		case 'Exception':
			//------------------------------------------------------------------------------
			ShowAlert(ExceptionsStack($Answer.Exception), 'Warning');
			//------------------------------------------------------------------------------
			break;
			//------------------------------------------------------------------------------
		case 'Ok':
			//------------------------------------------------------------------------------
			try {
				//------------------------------------------------------------------------------
				document.getElementById('UserFoto').src = '/UserFoto?Rand=' + (Math.round(Math.random() * 8999) + 1000);
				//------------------------------------------------------------------------------
			} catch (exception) {
				//------------------------------------------------------------------------------
				Debug(exception);
				//------------------------------------------------------------------------------
			};
			//------------------------------------------------------------------------------
			ShowTick('Информация успешно сохранена');
			//------------------------------------------------------------------------------
			break;
			//------------------------------------------------------------------------------
		default:
			//------------------------------------------------------------------------------
			alert('Не известный ответ');
			//------------------------------------------------------------------------------
		}
		//------------------------------------------------------------------------------
	};
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	var $Args = FormGet($Form);
	//------------------------------------------------------------------------------
	if (!$HTTP.Send('/API/UserPersonalDataChange', $Args)) {
		//------------------------------------------------------------------------------
		alert('Не удалось отправить запрос на сервер');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	ShowProgress('Смена персональных данных');
	//------------------------------------------------------------------------------
}

//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
// added by lissyara 2015-11-17 in 17:25 MSK
function Confirm($Method,$Value) {
	//------------------------------------------------------------------------------
	if (!$Method){
		//------------------------------------------------------------------------------
		ShowAlert('Не указан метод отправки кода подтвержения','Warning');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	if (!$Value){
		//------------------------------------------------------------------------------
		ShowAlert('Не указан адрес для отправки кода подтвержения','Warning');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	var $Form = document.forms['UserPersonalDataChangeForm'];
	//------------------------------------------------------------------------------
	$HTTP = new HTTP();
	//------------------------------------------------------------------------------
	if (!$HTTP.Resource) {
		//------------------------------------------------------------------------------
		alert('Не удалось создать HTTP соединение');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	$HTTP.onLoaded = function() {
		//------------------------------------------------------------------------------
		HideProgress();
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	$HTTP.onAnswer = function($Answer) {
		//------------------------------------------------------------------------------
		switch ($Answer.Status) {
		//------------------------------------------------------------------------------
		case 'Error':
			//------------------------------------------------------------------------------
			ShowAlert($Answer.Error.String, 'Warning');
			//------------------------------------------------------------------------------
			break;
			//------------------------------------------------------------------------------
		case 'Exception':
			//------------------------------------------------------------------------------
			ShowAlert(ExceptionsStack($Answer.Exception), 'Warning');
			//------------------------------------------------------------------------------
			break;
			//------------------------------------------------------------------------------
		case 'Ok':
			//------------------------------------------------------------------------------
			ShowAlert('Cообщение с кодом подтверждения успешно отправлено');
			//------------------------------------------------------------------------------
			break;
			//------------------------------------------------------------------------------
		default:
			alert('Не известный ответ');
		}
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	var $Args = { Method: $Method, Value: $Value };
	//------------------------------------------------------------------------------
	if (!$HTTP.Send('/API/Confirm', $Args)) {
		//------------------------------------------------------------------------------
		alert('Не удалось отправить запрос на сервер');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	ShowProgress('Отправка сообщения');
	//------------------------------------------------------------------------------
}

//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
// added by lissyara, 2015-11-18 in 16:40 MSK
function ConfirmCheck($Method,$Reset) {
	//------------------------------------------------------------------------------
	if (!$Method){
		//------------------------------------------------------------------------------
		ShowAlert('Не указан метод отправки кода подтвержения','Warning');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	var $Form = document.forms['UserPersonalDataChangeForm'];
	//------------------------------------------------------------------------------
	$HTTP = new HTTP();
	//------------------------------------------------------------------------------
	if (!$HTTP.Resource) {
		//------------------------------------------------------------------------------
		alert('Не удалось создать HTTP соединение');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	$HTTP.onLoaded = function() {
		//------------------------------------------------------------------------------
		HideProgress();
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	$HTTP.onAnswer = function($Answer) {
		//------------------------------------------------------------------------------
		switch ($Answer.Status) {
		case 'Error':
			//------------------------------------------------------------------------------
			ShowAlert($Answer.Error.String, 'Warning');
			//------------------------------------------------------------------------------
			break;
			//------------------------------------------------------------------------------
		case 'Exception':
			//------------------------------------------------------------------------------
			ShowAlert(ExceptionsStack($Answer.Exception), 'Warning');
			//------------------------------------------------------------------------------
			break;
			//------------------------------------------------------------------------------
		case 'Ok':
			//------------------------------------------------------------------------------
			$Message = 'Номер телефона успешно подтвержден, и теперь вам доступны настройки ' + $Method + ' уведомлений во вкладке "Уведомления".';
			//------------------------------------------------------------------------------
			if($Reset)
				$Message = $Message + 'Все предыдущие настройки для ' + $Method + ' были сброшены';
			//------------------------------------------------------------------------------
			ShowAlert($Message);
			//------------------------------------------------------------------------------
			break;
			//------------------------------------------------------------------------------
		default:
			alert('Неизвестный ответ');
		}
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	$Confirm = eval('$Form.' + $Method + 'Code.value');
	//------------------------------------------------------------------------------
	var $Args = {Method: $Method, Confirm: $Confirm};
	//------------------------------------------------------------------------------
	if (!$HTTP.Send('/API/Confirm', $Args)) {
		//------------------------------------------------------------------------------
		alert('Не удалось отправить запрос на сервер');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	ShowProgress('Проверка кода подтверждения');
	//------------------------------------------------------------------------------
}
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------

